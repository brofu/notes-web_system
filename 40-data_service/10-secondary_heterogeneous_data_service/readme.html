
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Secondary Heterogeneous Data Service Â· Brofu's Talk</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="00-pipeline.html" />
    
    
    <link rel="prev" href="../readme.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../10-front_end/readme.html">
            
                <a href="../../10-front_end/readme.html">
            
                    
                    Front End
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../20-access_layer/readme.html">
            
                <a href="../../20-access_layer/readme.html">
            
                    
                    Access Layer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../30-business_service/readme.html">
            
                <a href="../../30-business_service/readme.html">
            
                    
                    Business Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../readme.html">
            
                <a href="../readme.html">
            
                    
                    Data Service
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    Secondary Heterogeneous Data Service
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="00-pipeline.html">
            
                <a href="00-pipeline.html">
            
                    
                    Pipeline
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../50-middleware/readme.html">
            
                <a href="../../50-middleware/readme.html">
            
                    
                    Middleware
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../50-middleware/10-rpc/readme.html">
            
                <a href="../../50-middleware/10-rpc/readme.html">
            
                    
                    Rpc
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../../50-middleware/10-rpc/01-design/readme.html">
            
                <a href="../../50-middleware/10-rpc/01-design/readme.html">
            
                    
                    Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../../50-middleware/10-rpc/02-gRPC/readme.html">
            
                <a href="../../50-middleware/10-rpc/02-gRPC/readme.html">
            
                    
                    G RPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../../50-middleware/10-rpc/03-a_demo/readme.html">
            
                <a href="../../50-middleware/10-rpc/03-a_demo/readme.html">
            
                    
                    A Demo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.3.1" data-path="../../50-middleware/10-rpc/03-a_demo/class_diagram.html">
            
                <a href="../../50-middleware/10-rpc/03-a_demo/class_diagram.html">
            
                    
                    Class Diagram
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../60-database/">
            
                <a href="../../60-database/">
            
                    
                    Database
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../60-database/00-database_engine_architecture/readme.html">
            
                <a href="../../60-database/00-database_engine_architecture/readme.html">
            
                    
                    Database Engine Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../../60-database/10-MySQL/readme.html">
            
                <a href="../../60-database/10-MySQL/readme.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../../60-database/20-ElasticSearch/readme.html">
            
                <a href="../../60-database/20-ElasticSearch/readme.html">
            
                    
                    ElasticSearch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../../60-database/40-ClickHouse/readme.html">
            
                <a href="../../60-database/40-ClickHouse/readme.html">
            
                    
                    ClickHouse
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.4.1" data-path="../../60-database/40-ClickHouse/01-Summary/readme.html">
            
                <a href="../../60-database/40-ClickHouse/01-Summary/readme.html">
            
                    
                    Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4.2" data-path="../../60-database/40-ClickHouse/02-Architecture/readme.html">
            
                <a href="../../60-database/40-ClickHouse/02-Architecture/readme.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4.3" data-path="../../60-database/40-ClickHouse/03-SourceCode/readme.html">
            
                <a href="../../60-database/40-ClickHouse/03-SourceCode/readme.html">
            
                    
                    Source Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4.4" data-path="../../60-database/40-ClickHouse/04-Optimization/readme.html">
            
                <a href="../../60-database/40-ClickHouse/04-Optimization/readme.html">
            
                    
                    Optimization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.4.4.1" data-path="../../60-database/40-ClickHouse/04-Optimization/04-query_optimization/readme.html">
            
                <a href="../../60-database/40-ClickHouse/04-Optimization/04-query_optimization/readme.html">
            
                    
                    Query Optimization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../61-message_queue/readme.html">
            
                <a href="../../61-message_queue/readme.html">
            
                    
                    Message Queue
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../../61-message_queue/10-kafka/readme.html">
            
                <a href="../../61-message_queue/10-kafka/readme.html">
            
                    
                    Kafka
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="../../61-message_queue/10-kafka/10-usage/readme.html">
            
                <a href="../../61-message_queue/10-kafka/10-usage/readme.html">
            
                    
                    Usage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1.1" data-path="../../61-message_queue/10-kafka/10-usage/01-broker/readme.html">
            
                <a href="../../61-message_queue/10-kafka/10-usage/01-broker/readme.html">
            
                    
                    Broker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.2" >
            
                <span>
            
                    
                    Consumer
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1.2.1" data-path="../../61-message_queue/10-kafka/10-usage/02-consumer/02-consumer_group.html">
            
                <a href="../../61-message_queue/10-kafka/10-usage/02-consumer/02-consumer_group.html">
            
                    
                    Consumer Group
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.1.1.3" data-path="../../61-message_queue/10-kafka/10-usage/03-producer/readme.html">
            
                <a href="../../61-message_queue/10-kafka/10-usage/03-producer/readme.html">
            
                    
                    Producer
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1.3.1" data-path="../../61-message_queue/10-kafka/10-usage/03-producer/01-behavior_description.html">
            
                <a href="../../61-message_queue/10-kafka/10-usage/03-producer/01-behavior_description.html">
            
                    
                    Behavior Description
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.1.2" data-path="../../61-message_queue/10-kafka/20-principles/readme.html">
            
                <a href="../../61-message_queue/10-kafka/20-principles/readme.html">
            
                    
                    Principles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.2.1" data-path="../../61-message_queue/10-kafka/20-principles/02-broker/readme.html">
            
                <a href="../../61-message_queue/10-kafka/20-principles/02-broker/readme.html">
            
                    
                    Broker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2.2" data-path="../../61-message_queue/10-kafka/20-principles/03-consumer/readme.html">
            
                <a href="../../61-message_queue/10-kafka/20-principles/03-consumer/readme.html">
            
                    
                    Consumer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.1.2.3" data-path="../../61-message_queue/10-kafka/20-principles/03-producer/readme.html">
            
                <a href="../../61-message_queue/10-kafka/20-principles/03-producer/readme.html">
            
                    
                    Producer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../62-cache/readme.html">
            
                <a href="../../62-cache/readme.html">
            
                    
                    Cache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../../70-observability/readme.html">
            
                <a href="../../70-observability/readme.html">
            
                    
                    Observability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../../80-elastic_application/readme.html">
            
                <a href="../../80-elastic_application/readme.html">
            
                    
                    Elastic Application
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Secondary Heterogeneous Data Service</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="a-secondary-heterogeneous-data-service">A Secondary Heterogeneous Data Service</h1>
<h3 id="concept">Concept</h3>
<p>In this section, I will introduce a <code>Secondary Heterogeneous Data Service</code> with the E-commerce scenario. The key meaning of key words as follows:</p>
<ul>
<li><strong>Secondary</strong> means the data stored by the service is not the MAIN data. For example, the data of the main business service may be stored by MySQL database, but for some dedicated purpose, we may need to store the <strong>secondary</strong> copy of data somewhere.</li>
<li><strong>Heterogeneous</strong> means the structure of the data (depending on the purpose of the service) is DIFFERENT from the main data. For example, the main data is stored by MySQL, but the 2nd copy is stored by ElasticSearch or other engines.</li>
</ul>
<h3 id="key-problems">Key Problems</h3>
<p>We can get the key points at the first glance to this concept,</p>
<ul>
<li>The <strong>data sync mechanism</strong> between the main and the secondary copy.</li>
<li>The <strong>data consistency</strong> between the two copies. And,</li>
<li>How to <strong>store</strong> and <strong>query</strong> the second copy.</li>
</ul>
<p>In this series of posters, let&apos;s talk about each of them, and the solutions of course. </p>
<h3 id="a-real-world-example">A Real World Example</h3>
<p>First, let&apos;s look at an example from the real world.</p>
<h5 id="background">Background</h5>
<p>In the real world, MySQL is widely used as data store for e-commerce scenarios. And as the data scale growing, there would be new problems on our way. For example, </p>
<ul>
<li>As data scale growing, a common solution is to <strong>shard the data</strong> (we would talk about the data sharding in other series). For example, the <code>order</code> data maybe sharded by <code>order_id</code>. This works fine when query with <code>order_id</code>, for example, query the details of one order. But what if, we need to list all the order for one specific user?  </li>
<li>Usually, to improve the performance of data query, we need to setup some secondary indexes, but not too many. That&apos;s because too many indexes would impact the write performance. So, we need to think about carefully on which columns to involve the secondary indexes. Beside that, it impacts the online performance heavily also when adding/updating/deleting secondary indexes. But what if we really need this when there is a new business scenario?</li>
<li>Sometimes we may need some data aggregations based on the main data. One way is to do the aggregation on querying, and another way is just to record the aggregated somewhere. When query latency is required to be low, we may need to use the latter one solution. And the aggregation rules maybe changed from time to time (This is actually OLAP scenario). Definitely, we should NOT use this main storage for this.</li>
</ul>
<h5 id="solution">Solution</h5>
<p>The illustration of a possible solution as follows. </p>
<ul>
<li><p>The <code>Order Service</code> is the user side to this data service. And typically, it updates the data to the main data store.</p>
</li>
<li><p>The blue narrows stands for the <strong>data sync</strong>, which is asynchronous in the solution. Usually, some other components (<code>Kafka</code> as queue, for example) is are involved to make the system more functional and reliable. And this example, <code>ElasticSearch</code> is used for the secondary store. It depends on the business scenario what storage should be used for the secondary store. </p>
</li>
<li><p>The green narrows stands for the <strong>data query</strong> flow. </p>
</li>
<li><p>The pink narrows illustrate the <strong>data consistency verification &amp; fixing</strong> flow. This workflow is to handle the <strong>data consistency</strong> problem mentioned above.</p>
</li>
</ul>
<p>In the following articles, let&apos;s talk about the details of each part.</p>
<p></p><p style="text-align: center;"><b>Picture 1. Solution Architecture</b></p>
<img src="../images/10/solution.png" alt="Secondary Heterogeneous Data Service"><p></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../readme.html" class="navigation navigation-prev " aria-label="Previous page: Data Service">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="00-pipeline.html" class="navigation navigation-next " aria-label="Next page: Pipeline">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Secondary Heterogeneous Data Service","level":"1.5.1","depth":2,"next":{"title":"Pipeline","level":"1.5.1.1","depth":3,"path":"40-data_service/10-secondary_heterogeneous_data_service/00-pipeline.md","ref":"40-data_service/10-secondary_heterogeneous_data_service/00-pipeline.md","articles":[]},"previous":{"title":"Data Service","level":"1.5","depth":1,"path":"40-data_service/readme.md","ref":"40-data_service/readme.md","articles":[{"title":"Secondary Heterogeneous Data Service","level":"1.5.1","depth":2,"path":"40-data_service/10-secondary_heterogeneous_data_service/readme.md","ref":"40-data_service/10-secondary_heterogeneous_data_service/readme.md","articles":[{"title":"Pipeline","level":"1.5.1.1","depth":3,"path":"40-data_service/10-secondary_heterogeneous_data_service/00-pipeline.md","ref":"40-data_service/10-secondary_heterogeneous_data_service/00-pipeline.md","articles":[]}]}]},"dir":"ltr"},"config":{"plugins":["plantuml-cloud","disqus"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"plantuml-cloud":{"umlPath":"images/uml","protocol":"http","type":"plantuml-server","host":"www.plantuml.com","port":"80","path":"/plantuml/svg"},"disqus":{"useIdentifier":false,"shortName":"brofu-tech"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"sortedBy":"-","variables":{},"title":"Brofu's Talk","gitbook":"*","unchanged":["MySQL","ClickHouse","ElasticSearch","Test"]},"file":{"path":"40-data_service/10-secondary_heterogeneous_data_service/readme.md","mtime":"2023-12-26T10:14:04.701Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-12-26T10:14:45.382Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

